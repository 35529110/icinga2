#!/usr/bin/env python
from __future__ import unicode_literals

import sys
import time
import random

import utils


USERNAME = 'Icinga 2 Admin'


def send_command(command):
    return LIVESTATUS.query('COMMAND [{0}] {1}'.format(int(time.time()), command))


def test_host_comments(hostname):
    print repr(send_command('ADD_HOST_COMMENT;'+hostname+';0;'+USERNAME+';test'))
    return True


def test_service_comments(hostname, servicename):
    pass


def main():
    failure = False

    # Check whether host comments are properly processed
    if not test_host_comments('localhost') or not test_host_comments('nsca-ng'):
        failure = True

    return 1 if failure else 0


if __name__ == '__main__':
    with utils.LiveStatusSocket('/var/run/icinga2/cmd/livestatus') as LIVESTATUS:
        sys.exit(main())

